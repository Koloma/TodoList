//
//  LoginSceneRouter.swift
//  TodoList
//
//  Created by Коломенский Александр on 23.02.2023.
//  Copyright (c) 2023 KAV. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

@objc protocol ILoginSceneRouter
{
	func routeToMainScene()
}

protocol ILoginSceneDataPassing
{
	var dataStore: ILoginSceneDataStore? { get }
}

class LoginSceneRouter: NSObject, ILoginSceneRouter, ILoginSceneDataPassing
{
	weak var viewController: LoginSceneViewController?
	var dataStore: ILoginSceneDataStore?

	func routeToMainScene()
	{
		let destinationVC = assemblyMainScreen()
		guard
			let sourceVC = viewController,
			let loginDS = dataStore
			//var destinationDS = destinationVC.router?.dataStore
		else { fatalError("Fail route to MainSceneViewController")}

		//passDataToMainScene(source: loginDS, destination: &destinationDS)
		navigateToMainScene(source: sourceVC, destination: destinationVC)
	}

	// MARK: Navigation
	func navigateToMainScene(source: LoginSceneViewController, destination: MainSceneViewController)
	{
		source.navigationController?.pushViewController(destination, animated: true)
	}

	// MARK: Passing data
	func passDataToMainScene(source: ILoginSceneDataStore, destination: inout IMainSceneDataStore)
	{
		destination.lastLoginDate = source.lastLoginDate ?? Date()
		destination.login = source.login ?? ""
		destination.email = source.email ?? ""
	}

	private func assemblyMainScreen() -> MainSceneViewController {
		let viewController = MainSceneViewController()

		let presenter = MainScenePresenter(view: viewController)
		let mainSceneWorker = MainSceneWorker()
		let interactor = MainSceneInteractor(worker: mainSceneWorker, presenter: presenter)
		let router = MainSceneRouter()

		viewController.interactor = interactor
		router.viewController = viewController
		router.dataStore = interactor

		return viewController
	}
}
